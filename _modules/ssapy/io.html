

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ssapy.io &mdash; SSAPy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />

  
    <link rel="shortcut icon" href="../../_static/ssapy_logo.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/ssapy_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">SSAPy by Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../benchmarks.html">SSAPy Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">SSAPy Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API DOCS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SSAPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ssapy.io</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ssapy.io</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Collection of functions to read from and write to various file formats.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">EARTH_MU</span>


<span class="n">telescope_catalog</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;511&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;SST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1496.451</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5096.210</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">,</span>
        <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mf">3523.795</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span>
    <span class="p">},</span>
    <span class="s2">&quot;241&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Diego Garcia&quot;</span><span class="p">,</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">1907.068</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">6030.792</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">,</span>
        <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">817.291</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span>
    <span class="p">}</span>
<span class="p">}</span>


<div class="viewcode-block" id="read_tle_catalog"><a class="viewcode-back" href="../../api/ssapy.io.read_tle_catalog.html#ssapy.io.read_tle_catalog">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">read_tle_catalog</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">n_lines</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a TLE catalog file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : string</span>
<span class="sd">        The filename</span>
<span class="sd">    n_lines : int</span>
<span class="sd">        number of lines per tle, usually 2 but sometimes 3</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    catalog : list</span>
<span class="sd">        lists containing TLEs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">tles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lines</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">),</span> <span class="n">n_lines</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">tles</span></div>


<div class="viewcode-block" id="read_tle"><a class="viewcode-back" href="../../api/ssapy.io.read_tle.html#ssapy.io.read_tle">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">read_tle</span><span class="p">(</span><span class="n">sat_name</span><span class="p">,</span> <span class="n">tle_filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the TLE data from the file for the satellite with the given name</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    sat_name : str</span>
<span class="sd">        NORAD name of the satellite</span>
<span class="sd">    tle_filename : str</span>
<span class="sd">        Path and name of file where TLE is</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    line1, line2 : str</span>
<span class="sd">        Both lines of the satellite TLE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tle_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">tle_f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tle_f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sat_line_ind</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sat_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
            <span class="s2">&quot;No satellite &#39;</span><span class="si">{}</span><span class="s2">&#39; in file &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sat_name</span><span class="p">,</span> <span class="n">tle_filename</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">sat_line_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">sat_line_ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Incorrectly formatted TLE file&quot;</span><span class="p">)</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_rvt_from_tle_tuple</span><span class="p">(</span><span class="n">tle_tuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get r, v, t (in the TEME frame!) from TLE tuple</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tle_tuple : 2-tuple of str</span>
<span class="sd">        Line1 and Line2 of TLE as strings</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    r : array_like (3,)</span>
<span class="sd">        Position in meters in TEME frame</span>
<span class="sd">    v : array_like 3(,)</span>
<span class="sd">        Velocity in meters in TEME frame</span>
<span class="sd">    t : float</span>
<span class="sd">        Time in GPS seconds; i.e., seconds since 1980-01-06 00:00:00 UTC.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function returns positions and velocities in the TEME frame!  This is</span>
<span class="sd">    not the same frame as used by ssapy.Orbit constructor.  Please use</span>
<span class="sd">    ssapy.Orbit.fromTLETuple() to construct an Orbit object from a TLE.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sgp4.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">Satrec</span>
    <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span> <span class="o">=</span> <span class="n">tle_tuple</span>
    <span class="n">sat</span> <span class="o">=</span> <span class="n">Satrec</span><span class="o">.</span><span class="n">twoline2rv</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">sat</span><span class="o">.</span><span class="n">sgp4_tsince</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">epoch_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">sat</span><span class="o">.</span><span class="n">jdsatepoch</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
    <span class="n">epoch_time</span> <span class="o">+=</span> <span class="n">sat</span><span class="o">.</span><span class="n">jdsatepochF</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span>
    <span class="c1"># Convert from km to m</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">epoch_time</span><span class="o">.</span><span class="n">gps</span>


<div class="viewcode-block" id="parse_tle"><a class="viewcode-back" href="../../api/ssapy.io.parse_tle.html#ssapy.io.parse_tle">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">parse_tle</span><span class="p">(</span><span class="n">tle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a TLE returning Kozai mean orbital elements.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tle : 2-tuple of str</span>
<span class="sd">        Line1 and Line2 of TLE as strings</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : float</span>
<span class="sd">        Kozai mean semi-major axis in meters</span>
<span class="sd">    e : float</span>
<span class="sd">        Kozai mean eccentricity</span>
<span class="sd">    i : float</span>
<span class="sd">        Kozai mean inclination in radians</span>
<span class="sd">    pa : float</span>
<span class="sd">        Kozai mean periapsis argument in radians</span>
<span class="sd">    raan : float</span>
<span class="sd">        Kozai mean right ascension of the ascending node in radians</span>
<span class="sd">    trueAnomaly : float</span>
<span class="sd">        Kozai mean true anomaly in radians</span>
<span class="sd">    t : float</span>
<span class="sd">        GPS seconds; i.e., seconds since 1980-01-06 00:00:00 UTC</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Dynamic TLE terms, including the drag coefficient and ballistic coefficient,</span>
<span class="sd">    are ignored in this function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sgp4.ext</span><span class="w"> </span><span class="kn">import</span> <span class="n">days2mdhms</span><span class="p">,</span> <span class="n">invjday</span><span class="p">,</span> <span class="n">jday</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.orbit</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">_ellipticalEccentricToTrueAnomaly</span><span class="p">,</span>
        <span class="n">_ellipticalMeanToEccentricAnomaly</span>
    <span class="p">)</span>
    <span class="c1"># just grabbing the bits we care about for now.</span>
    <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span> <span class="o">=</span> <span class="n">tle</span>
    <span class="k">assert</span> <span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span>
    <span class="k">assert</span> <span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
    <span class="n">epochDay</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">32</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
    <span class="n">raan</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">25</span><span class="p">])</span>
    <span class="n">e</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">26</span><span class="p">:</span><span class="mi">33</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e7</span>
    <span class="n">pa</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">34</span><span class="p">:</span><span class="mi">42</span><span class="p">])</span>
    <span class="n">meanAnomaly</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">43</span><span class="p">:</span><span class="mi">51</span><span class="p">])</span>
    <span class="n">meanMotion</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">52</span><span class="p">:</span><span class="mi">63</span><span class="p">])</span>

    <span class="c1"># Adjust units</span>
    <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">57</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">+=</span> <span class="mi">1900</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">+=</span> <span class="mi">2000</span>
    <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">days2mdhms</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">epochDay</span><span class="p">)</span>
    <span class="n">jdsatepoch</span> <span class="o">=</span> <span class="n">jday</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span>
    <span class="n">sec_whole</span><span class="p">,</span> <span class="n">sec_frac</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
            <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec_whole</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec_frac</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">//</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">invjday</span><span class="p">(</span><span class="n">jdsatepoch</span><span class="p">)</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
            <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec_whole</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec_frac</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">//</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Assuming decimal year UTC?</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">raan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">raan</span><span class="p">)</span>
    <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">pa</span><span class="p">)</span>
    <span class="n">meanAnomaly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">meanAnomaly</span><span class="p">)</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>

    <span class="n">period</span> <span class="o">=</span> <span class="mf">86400.</span> <span class="o">/</span> <span class="n">meanMotion</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">period</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">EARTH_MU</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">trueAnomaly</span> <span class="o">=</span> <span class="n">_ellipticalEccentricToTrueAnomaly</span><span class="p">(</span>
        <span class="n">_ellipticalMeanToEccentricAnomaly</span><span class="p">(</span>
            <span class="n">meanAnomaly</span><span class="p">,</span> <span class="n">e</span>
        <span class="p">),</span>
        <span class="n">e</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">raan</span><span class="p">,</span> <span class="n">trueAnomaly</span><span class="p">,</span> <span class="n">epoch</span><span class="o">.</span><span class="n">gps</span></div>


<div class="viewcode-block" id="make_tle"><a class="viewcode-back" href="../../api/ssapy.io.make_tle.html#ssapy.io.make_tle">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">make_tle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">raan</span><span class="p">,</span> <span class="n">trueAnomaly</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a TLE from Kozai mean orbital elements</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : float</span>
<span class="sd">        Kozai mean semi-major axis in meters</span>
<span class="sd">    e : float</span>
<span class="sd">        Kozai mean eccentricity</span>
<span class="sd">    i : float</span>
<span class="sd">        Kozai mean inclination in radians</span>
<span class="sd">    pa : float</span>
<span class="sd">        Kozai mean periapsis argument in radians</span>
<span class="sd">    raan : float</span>
<span class="sd">        Kozai mean right ascension of the ascending node in radians</span>
<span class="sd">    trueAnomaly : float</span>
<span class="sd">        Kozai mean true anomaly in radians</span>
<span class="sd">    t : float or astropy.time.Time</span>
<span class="sd">        If float, then should correspond to GPS seconds; i.e., seconds since</span>
<span class="sd">        1980-01-06 00:00:00 UTC</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Dynamic TLE terms, including the drag coefficient and ballistic coefficient,</span>
<span class="sd">    are ignored in this function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.orbit</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">_ellipticalEccentricToMeanAnomaly</span><span class="p">,</span>
        <span class="n">_ellipticalTrueToEccentricAnomaly</span>
    <span class="p">)</span>

    <span class="n">line1</span> <span class="o">=</span> <span class="s2">&quot;1 99999U 99999ZZZ &quot;</span>
    <span class="n">line2</span> <span class="o">=</span> <span class="s2">&quot;2 99999 &quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;gps&#39;</span><span class="p">)</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">yday</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

    <span class="n">day</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span>

    <span class="n">line1</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">line1</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:012.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
    <span class="n">line1</span> <span class="o">+=</span> <span class="s2">&quot; +.00000000 +00000-0  99999-0 0 0000&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">checksum</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                <span class="n">check</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">check</span> <span class="o">+=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">check</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">line1</span> <span class="o">+=</span> <span class="n">checksum</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>

    <span class="n">line2</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:8.4f}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">line2</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:8.4f}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">raan</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="n">line2</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:07d}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="mf">1e7</span><span class="p">))</span>
    <span class="n">line2</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:8.4f}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">pa</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="n">meanAnomaly</span> <span class="o">=</span> <span class="n">_ellipticalEccentricToMeanAnomaly</span><span class="p">(</span>
        <span class="n">_ellipticalTrueToEccentricAnomaly</span><span class="p">(</span>
            <span class="n">trueAnomaly</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">e</span>
        <span class="p">),</span>
        <span class="n">e</span>
    <span class="p">)</span>

    <span class="n">line2</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:8.4f}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">meanAnomaly</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="n">meanMotion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">EARTH_MU</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>  <span class="c1"># rad/s</span>
    <span class="n">meanMotion</span> <span class="o">*=</span> <span class="mi">86400</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">line2</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:11.8f}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meanMotion</span><span class="p">)</span>
    <span class="n">line2</span> <span class="o">+=</span> <span class="s2">&quot;   0&quot;</span>
    <span class="n">line2</span> <span class="o">+=</span> <span class="n">checksum</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span></div>


<div class="viewcode-block" id="get_tel_pos_itrf_to_gcrs"><a class="viewcode-back" href="../../api/ssapy.io.get_tel_pos_itrf_to_gcrs.html#ssapy.io.get_tel_pos_itrf_to_gcrs">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_tel_pos_itrf_to_gcrs</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">tel_label</span><span class="o">=</span><span class="s2">&quot;511&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert telescope locations in ITRF (i.e., fixed to the earth) to GCRS</span>
<span class="sd">    (i.e., geocentric celestial frame)</span>

<span class="sd">    :param time: Time at which to evaluate the position</span>
<span class="sd">    :type time: astropy.time.Time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">telescope_catalog</span><span class="p">[</span><span class="n">tel_label</span><span class="p">]</span>
    <span class="c1"># Astropy:</span>
    <span class="n">rITRF</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">CartesianRepresentation</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">tp</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">tp</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">])</span>
    <span class="n">itrs</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">ITRS</span><span class="p">(</span><span class="n">rITRF</span><span class="p">,</span> <span class="n">obstime</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="n">gcrs</span> <span class="o">=</span> <span class="n">itrs</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">GCRS</span><span class="p">(</span><span class="n">obstime</span><span class="o">=</span><span class="n">time</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">gcrs</span><span class="o">.</span><span class="n">cartesian</span><span class="o">.</span><span class="n">xyz</span></div>

<span class="c1"># Additional reference:</span>
<span class="c1"># https://fas.org/spp/military/program/track/space_pulvermacher.pdf</span>
<span class="c1">#</span>
<span class="c1"># Right ascension:</span>
<span class="c1"># The angle between the vernal equinox</span>
<span class="c1"># and the projection of the radius vector on the equatorial plane, regarded as</span>
<span class="c1"># positive when measured eastward from the vernal equinox. [AFSPCI 60-102]</span>
<span class="c1"># Measurement units must be degrees.</span>
<span class="c1">#</span>
<span class="c1"># Declination:</span>
<span class="c1"># The angle between the celestial equator and a radius vector, regarded as</span>
<span class="c1"># positive when measured north from the celestial equator.</span>
<span class="c1"># [AFSPCI 60-102] Measurement units must be degrees.</span>
<span class="c1">#</span>
<span class="c1"># For type 9:</span>
<span class="c1"># SensorLocation described as an E,F,G (Earth-Fixed Geocentric) position vector</span>
<span class="c1"># of mobile sensor measured in meters</span>
<span class="c1"># Values are epoched to the observation&#39;s epoch.</span>
<span class="c1">#</span>
<span class="c1"># Reference: [AFSPCI 60-102] Air Force Space Command (AFSPC) Astrodynamic</span>
<span class="c1"># Standards, AFSPC Instruction 60-102, 11 March 1996.</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># JEM implementation</span>
<span class="c1"># =============================================================================</span>


<span class="n">b3dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;secClass&#39;</span><span class="p">,</span> <span class="s1">&#39;U1&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;satID&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;sensID&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;polarAngle&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;azimuthAngle&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;slantRangeRate&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;equinoxType&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<span class="p">])</span>


<div class="viewcode-block" id="parseB3Line"><a class="viewcode-back" href="../../api/ssapy.io.parseB3Line.html#ssapy.io.parseB3Line">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">parseB3Line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read one line of a B3 file and parse into distinct catalog components</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">74</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>

    <span class="n">secClass</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">satID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">sensID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span>
    <span class="n">year</span> <span class="o">=</span> <span class="mi">1900</span> <span class="o">+</span> <span class="n">year</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="k">else</span> <span class="mi">2000</span> <span class="o">+</span> <span class="n">year</span>
    <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">14</span><span class="p">])</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
    <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">])</span>
    <span class="n">millisec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">23</span><span class="p">])</span>
    <span class="n">sec</span> <span class="o">=</span> <span class="n">millisec</span> <span class="o">/</span> <span class="mf">1000.0</span>
    <span class="c1"># Note, I&#39;m assuming that &quot;-51280&quot; is -5.128 degrees, and that</span>
    <span class="c1"># the overpunching only applies when dec &lt;= -10 degrees.</span>
    <span class="n">polarAngleStr</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">29</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s2">&quot;JKLMNOPQR&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)):</span>
        <span class="n">polarAngleStr</span> <span class="o">=</span> <span class="n">polarAngleStr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="s2">&quot;-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">polarAngle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">polarAngleStr</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e4</span>
    <span class="k">if</span> <span class="n">type_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">]:</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">32</span><span class="p">])</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">34</span><span class="p">])</span>
        <span class="n">sss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">34</span><span class="p">:</span><span class="mi">37</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="n">azimuthAngle</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="p">(</span><span class="n">hh</span> <span class="o">+</span> <span class="p">(</span><span class="n">mm</span> <span class="o">+</span> <span class="n">sss</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">azimuthAngle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">37</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e4</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">45</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e5</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rangeExp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">45</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">rangeExp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="n">range_</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">rangeExp</span>
    <span class="k">if</span> <span class="n">type_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]:</span>
        <span class="n">slantRangeRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">55</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">55</span><span class="p">:</span><span class="mi">64</span><span class="p">])</span>
            <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">65</span><span class="p">:</span><span class="mi">73</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">slantRangeRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">47</span><span class="p">:</span><span class="mi">54</span><span class="p">])</span><span class="o">/</span><span class="mf">1e5</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">slantRangeRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">if</span> <span class="n">type_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">]:</span>
        <span class="n">equinoxType</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">75</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">equinoxType</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span>
        <span class="n">secClass</span><span class="p">,</span>
        <span class="n">satID</span><span class="p">,</span>
        <span class="n">sensID</span><span class="p">,</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span>
        <span class="n">polarAngle</span><span class="p">,</span> <span class="n">azimuthAngle</span><span class="p">,</span>
        <span class="n">range_</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
        <span class="n">slantRangeRate</span><span class="p">,</span>
        <span class="n">type_</span><span class="p">,</span>
        <span class="n">equinoxType</span>
    <span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">b3dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="parseB3"><a class="viewcode-back" href="../../api/ssapy.io.parseB3.html#ssapy.io.parseB3">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">parseB3</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load data from a B3 observation file</span>

<span class="sd">    :param filename: Name of the B3 obs file to load</span>
<span class="sd">    :type filename: string</span>

<span class="sd">    :return: A catalog of observations</span>
<span class="sd">    :rtype: astropy.table.Table</span>

<span class="sd">    Note that angles and positions are output in TEME frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parseB3Line</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">]),</span>
                                      <span class="s2">&quot;%Y %j %H %M&quot;</span><span class="p">)</span>
           <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">])</span>
           <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">dts</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mjd</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gps</span>

    <span class="k">return</span> <span class="n">data</span></div>



<span class="c1"># =============================================================================</span>
<span class="c1"># MDS implementation</span>
<span class="c1"># =============================================================================</span>
<span class="n">b3obs_types</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Range rate only&quot;</span><span class="p">,</span>  <span class="c1"># 0</span>
    <span class="s2">&quot;Azimuth &amp; elevation&quot;</span><span class="p">,</span>  <span class="c1"># 1</span>
    <span class="s2">&quot;Range, azimuth, &amp; elevation&quot;</span><span class="p">,</span>  <span class="c1"># 2</span>
    <span class="s2">&quot;Range, azimuth, elevation, &amp; range rate&quot;</span><span class="p">,</span>  <span class="c1"># 3</span>
    <span class="c1"># 4</span>
    <span class="s2">&quot;Range, azimuth, elevation, &amp; range rate (extra measurements for azimuth rate, elevation rate, etc are ignored)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Right Ascension &amp; Declination&quot;</span><span class="p">,</span>  <span class="c1"># 5</span>
    <span class="s2">&quot;Range only&quot;</span><span class="p">,</span>  <span class="c1"># 6</span>
    <span class="s2">&quot;UNDEFINED&quot;</span><span class="p">,</span>  <span class="c1"># 7</span>
    <span class="s2">&quot;Space-based azimuth, elevation, sometimes range and EFG position of the sensor&quot;</span><span class="p">,</span>  <span class="c1"># 8</span>
    <span class="s2">&quot;Space-based right ascension, declination, sometimes range and EFG position of the sensor&quot;</span><span class="p">,</span>  <span class="c1"># 9</span>
<span class="p">]</span>


<span class="n">overpunched</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="parse_overpunched"><a class="viewcode-back" href="../../api/ssapy.io.parse_overpunched.html#ssapy.io.parse_overpunched">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">parse_overpunched</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse and adjust a string containing overpunched numeric values.</span>

<span class="sd">    This function processes a given string to handle overpunched numeric values, </span>
<span class="sd">    which are a legacy encoding method for representing negative numbers in specific </span>
<span class="sd">    positions. If the first character of the string matches an overpunched value, </span>
<span class="sd">    it is replaced with its corresponding negative numeric value.</span>

<span class="sd">    Overpunched values are defined as:</span>
<span class="sd">        [&#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;]</span>

<span class="sd">    The index of the overpunched character determines the numeric value, starting </span>
<span class="sd">    from -1 for &#39;J&#39;, -2 for &#39;K&#39;, and so on.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (str): The input string to be parsed and adjusted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The modified string where overpunched values have been replaced </span>
<span class="sd">             with their numeric equivalents.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">line_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">overpunched</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">overpunched</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">line_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">line_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_vals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span></div>


<div class="viewcode-block" id="b3obs2pos"><a class="viewcode-back" href="../../api/ssapy.io.b3obs2pos.html#ssapy.io.b3obs2pos">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">b3obs2pos</span><span class="p">(</span><span class="n">b3line</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return an SGP4 Satellite imported from B3OBS data.</span>

<span class="sd">    Intended to mimic the sgp4 twoline2rv function</span>

<span class="sd">    Data format reference:</span>
<span class="sd">    http://help.agi.com/odtk/index.html?page=source%2Fod%2FODObjectsMeasurementFormatsandMeasurementTypes.htm</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">Angle</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b3line</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">76</span><span class="p">):</span>
        <span class="n">security_classification</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">satellite_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>  <span class="c1"># corresponds to SSC number</span>
        <span class="n">sensor_id</span> <span class="o">=</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">two_digit_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span>
        <span class="n">day_of_year</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">14</span><span class="p">])</span>
        <span class="c1"># hms = float(b3line[14:20] + &#39;.&#39; + b3line[20:23])</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">])</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">23</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="n">obs_type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">74</span><span class="p">])</span>
        <span class="c1"># print(&quot;obs_type:&quot;, obs_type)</span>
        <span class="c1">#</span>
        <span class="n">el_or_dec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parse_overpunched</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">25</span><span class="p">])</span> <span class="o">+</span>
                          <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">25</span><span class="p">:</span><span class="mi">29</span><span class="p">])</span>  <span class="c1"># degrees</span>
        <span class="c1"># Column 30 is blank</span>
        <span class="k">if</span> <span class="n">obs_type</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">obs_type</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span> <span class="c1"># Have RA</span>
            <span class="n">az_or_ra</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;h&#39;</span> <span class="o">+</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">34</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;m&#39;</span> <span class="o">+</span>
                             <span class="n">b3line</span><span class="p">[</span><span class="mi">34</span><span class="p">:</span><span class="mi">36</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Have azimuth</span>
            <span class="n">az_or_ra</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">33</span><span class="p">]</span> <span class="o">+</span>
                             <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">37</span><span class="p">])</span>  <span class="c1"># degrees</span>
        <span class="c1"># Column 38 is blank</span>
        <span class="n">range_in_km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">45</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">45</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
            <span class="n">range_in_km</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">45</span><span class="p">])</span>
            <span class="n">range_exp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">45</span><span class="p">])</span>
            <span class="n">range_in_km</span> <span class="o">*=</span> <span class="mf">10.</span><span class="o">**</span><span class="n">range_exp</span>

        <span class="n">obs_type_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">obs_type</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">73</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                <span class="n">slant_range</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">47</span><span class="p">:</span><span class="mi">49</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">49</span><span class="p">:</span><span class="mi">54</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># obs_type == 8 or 9</span>
            <span class="n">x_sat</span> <span class="o">=</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">55</span><span class="p">]</span>
            <span class="n">y_sat</span> <span class="o">=</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">55</span><span class="p">:</span><span class="mi">64</span><span class="p">]</span>
            <span class="n">z_sat</span> <span class="o">=</span> <span class="n">b3line</span><span class="p">[</span><span class="mi">64</span><span class="p">:</span><span class="mi">73</span><span class="p">]</span>
        <span class="c1"># Column 74 is blank</span>
        <span class="n">equinox</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b3line</span><span class="p">[</span><span class="mi">75</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;B3OBS format error&quot;</span><span class="p">)</span>

    <span class="n">epochdays</span> <span class="o">=</span> <span class="n">day_of_year</span>

    <span class="k">if</span> <span class="n">two_digit_year</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">two_digit_year</span> <span class="o">+</span> <span class="mi">2000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">two_digit_year</span> <span class="o">+</span> <span class="mi">1900</span>

    <span class="n">epoch</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">day_of_year</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="n">hours</span><span class="p">,</span>
                           <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="n">seconds</span><span class="p">)</span>

    <span class="n">ra_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">dec_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">if</span> <span class="n">obs_type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="c1"># Convert from hms to deg</span>
        <span class="n">ra_deg</span> <span class="o">=</span> <span class="n">az_or_ra</span><span class="o">.</span><span class="n">deg</span>
        <span class="n">dec_deg</span> <span class="o">=</span> <span class="n">el_or_dec</span>  <span class="c1"># already in degrees</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tel</span> <span class="o">=</span> <span class="n">telescope_catalog</span><span class="p">[</span><span class="n">sensor_id</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">tel</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">tel</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">tel</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">tel_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">tel_pos</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;satnum&quot;</span><span class="p">:</span> <span class="n">satellite_id</span><span class="p">,</span>
            <span class="s2">&quot;sensnum&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">sensor_id</span><span class="p">),</span>
            <span class="s2">&quot;epoch&quot;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">,</span>
            <span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="n">ra_deg</span><span class="p">,</span>
            <span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="n">dec_deg</span><span class="p">,</span>
            <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="n">range_in_km</span><span class="p">,</span>
            <span class="s2">&quot;tel_pos&quot;</span><span class="p">:</span> <span class="n">tel_pos</span>
            <span class="p">}</span></div>


<div class="viewcode-block" id="load_b3obs_file"><a class="viewcode-back" href="../../api/ssapy.io.load_b3obs_file.html#ssapy.io.load_b3obs_file">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">load_b3obs_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function to load all entries in a B3OBS file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">b3obs2pos</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">iline</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">76</span><span class="p">])</span> <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">))]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">catalog</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;ra&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]),</span>
        <span class="s2">&quot;dec&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]),</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]),</span>
        <span class="s2">&quot;sensnum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;sensnum&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">],</span>
        <span class="s2">&quot;satnum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;satnum&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">],</span>
        <span class="s2">&quot;tel_pos&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;tel_pos&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">catalog</span></div>

<span class="c1"># =============================================================================</span>
<span class="c1"># File Handling Functions</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="file_exists_extension_agnostic"><a class="viewcode-back" href="../../api/ssapy.io.file_exists_extension_agnostic.html#ssapy.io.file_exists_extension_agnostic">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">file_exists_extension_agnostic</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a file with the given name and any extension exists.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name of the file to check, without extension.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if a file with the given name and any extension exists, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">glob</span><span class="w"> </span><span class="kn">import</span> <span class="n">glob</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.*&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="exists"><a class="viewcode-back" href="../../api/ssapy.io.exists.html#ssapy.io.exists">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a file or directory exists.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    pathname : str</span>
<span class="sd">        The path to the file or directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the path exists as either a file or a directory, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="mkdir"><a class="viewcode-back" href="../../api/ssapy.io.mkdir.html#ssapy.io.mkdir">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">mkdir</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a directory if it does not exist.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    pathname : str</span>
<span class="sd">        The path to the directory to be created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory &#39;</span><span class="si">%s</span><span class="s2">&#39; created&quot;</span> <span class="o">%</span> <span class="n">pathname</span><span class="p">)</span>        
    <span class="k">return</span></div>


<div class="viewcode-block" id="rmdir"><a class="viewcode-back" href="../../api/ssapy.io.rmdir.html#ssapy.io.rmdir">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">rmdir</span><span class="p">(</span><span class="n">source_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes a directory and its contents if it exists.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    source_ : str</span>
<span class="sd">        The path to the directory to be deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">source_</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">source_</span><span class="si">}</span><span class="s1">, does not exist, no delete.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Deleted </span><span class="si">{</span><span class="n">source_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">source_</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="rmfile"><a class="viewcode-back" href="../../api/ssapy.io.rmfile.html#ssapy.io.rmfile">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">rmfile</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes a file if it exists.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    pathname : str</span>
<span class="sd">        The path to the file to be deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">pathname</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File: &#39;</span><span class="si">%s</span><span class="s2">&#39; deleted.&quot;</span> <span class="o">%</span> <span class="n">pathname</span><span class="p">)</span>        
    <span class="k">return</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_sortbynum</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sorts a list of file paths based on numeric values in the filenames.</span>

<span class="sd">    This function assumes that each filename contains at least one numeric value</span>
<span class="sd">    and sorts the files based on the first numeric value found in the filename.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    files : list</span>
<span class="sd">        List of file paths to be sorted. Each file path can be a full path or just a filename.</span>
<span class="sd">    index: int</span>
<span class="sd">        Index of the number in the string do you want to sort on.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of file paths sorted by numeric values in their filenames.</span>

<span class="sd">    Notes:</span>
<span class="sd">    -----</span>
<span class="sd">    - This function extracts the first numeric value it encounters in each filename.</span>
<span class="sd">    - If no numeric value is found in a filename, the function may raise an error.</span>
<span class="sd">    - The numeric value can appear anywhere in the filename.</span>
<span class="sd">    - The function does not handle cases where filenames have different directory prefixes.</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError:</span>
<span class="sd">        If a filename does not contain any numeric value.</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; _sortbynum([&#39;file2.txt&#39;, &#39;file10.txt&#39;, &#39;file1.txt&#39;])</span>
<span class="sd">    [&#39;file1.txt&#39;, &#39;file2.txt&#39;, &#39;file10.txt&#39;]</span>

<span class="sd">    &gt;&gt;&gt; _sortbynum([&#39;/path/to/file2.txt&#39;, &#39;/path/to/file10.txt&#39;, &#39;/path/to/file1.txt&#39;])</span>
<span class="sd">    [&#39;/path/to/file1.txt&#39;, &#39;/path/to/file2.txt&#39;, &#39;/path/to/file10.txt&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">files_shortened</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">file_prefix</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">files_shortened</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">files_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files_shortened</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="n">index</span><span class="p">]))</span>
        <span class="n">sorted_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_sorted</span><span class="p">:</span>
            <span class="n">sorted_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_prefix</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sorted_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="n">index</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">sorted_files</span>


<div class="viewcode-block" id="listdir"><a class="viewcode-back" href="../../api/ssapy.io.listdir.html#ssapy.io.listdir">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">files_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lists files and directories in a specified path with optional filtering and sorting.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    dir_path : str, default=&#39;*&#39;</span>
<span class="sd">        The directory path or pattern to match files and directories.</span>
<span class="sd">    files_only : bool, default=False</span>
<span class="sd">        If True, only returns files, excluding directories.</span>
<span class="sd">    exclude : str or None, optional</span>
<span class="sd">        If specified, excludes files and directories whose base name contains this string.</span>
<span class="sd">    sorted : bool, default=False</span>
<span class="sd">        If True, sorts the resulting list by numeric values in filenames.</span>
<span class="sd">    index : int, default=0</span>
<span class="sd">        sorted required to be true. Index of the digit used for sorting.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        A list of file or directory paths based on the specified filters and sorting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">glob</span><span class="w"> </span><span class="kn">import</span> <span class="n">glob</span>
    <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dir_path</span><span class="p">:</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
    <span class="n">expanded_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">files_only</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">expanded_paths</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files in </span><span class="si">{</span><span class="n">dir_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">expanded_paths</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files in </span><span class="si">{</span><span class="n">dir_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">exclude</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">new_files</span>
    <span class="k">if</span> <span class="nb">sorted</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_sortbynum</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">files</span></div>


<div class="viewcode-block" id="get_memory_usage"><a class="viewcode-back" href="../../api/ssapy.io.get_memory_usage.html#ssapy.io.get_memory_usage">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_memory_usage</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the memory usage of the current process.</span>

<span class="sd">    This function retrieves the memory usage of the current Python process </span>
<span class="sd">    using the `psutil` library and prints it in gigabytes (GB). The memory </span>
<span class="sd">    usage is calculated based on the resident set size (RSS), which represents </span>
<span class="sd">    the portion of memory occupied by the process in RAM.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: The function does not return a value. It prints the memory usage directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory used: </span><span class="si">{</span><span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span></div>

<span class="c1">######################################################################</span>
<span class="c1"># Load and Save Functions</span>
<span class="c1">######################################################################</span>
<span class="c1">######################################################################</span>
<span class="c1"># Pickles</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="save_pickle"><a class="viewcode-back" href="../../api/ssapy.io.save_pickle.html#ssapy.io.save_pickle">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">save_pickle</span><span class="p">(</span><span class="n">filename_</span><span class="p">,</span> <span class="n">data_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save data to a pickle file.</span>

<span class="sd">    This function serializes the given data and saves it to the specified file path </span>
<span class="sd">    using the pickle module. The file is opened in write-binary mode to ensure </span>
<span class="sd">    proper saving of the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename_ (str): The path to the file where the data will be saved.</span>
<span class="sd">        data_ (object): The data to be serialized and saved to the pickle file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: The function does not return a value. The data is saved to the specified file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">six.moves</span><span class="w"> </span><span class="kn">import</span> <span class="n">cPickle</span> <span class="k">as</span> <span class="n">pickle</span>  <span class="c1"># for performance</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="load_pickle"><a class="viewcode-back" href="../../api/ssapy.io.load_pickle.html#ssapy.io.load_pickle">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">load_pickle</span><span class="p">(</span><span class="n">filename_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load data from a pickle file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename_ (str): The path to the pickle file to be loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        object: The data loaded from the pickle file. If an error occurs, </span>
<span class="sd">                an empty list is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">six.moves</span><span class="w"> </span><span class="kn">import</span> <span class="n">cPickle</span> <span class="k">as</span> <span class="n">pickle</span>  <span class="c1"># for performance</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># print(&#39;Openning: &#39; + current_filename)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">EOFError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1"> - current_filename&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="merge_dicts"><a class="viewcode-back" href="../../api/ssapy.io.merge_dicts.html#ssapy.io.merge_dicts">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">merge_dicts</span><span class="p">(</span><span class="n">file_names</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge multiple dictionaries stored in pickle files into a single dictionary and save the result.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_names (list of str): A list of file paths to pickle files containing dictionaries to merge.</span>
<span class="sd">        save_path (str): The file path where the merged dictionary will be saved as a pickle file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: The function does not return a value. The merged dictionary is saved to `save_path`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number_of_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_names</span><span class="p">);</span> <span class="n">master_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_names</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Merging dict: </span><span class="si">{</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">number_of_files</span><span class="si">}</span><span class="s1">, name: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">, num of master keys: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">master_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">, num of new keys: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">master_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">master_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">load_pickle</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Beginning final save.&#39;</span><span class="p">)</span>
    <span class="n">save_pickle</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">master_dict</span><span class="p">)</span>
    <span class="k">return</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># Sliceable Numpys save and load</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="save_np"><a class="viewcode-back" href="../../api/ssapy.io.save_np.html#ssapy.io.save_np">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">save_np</span><span class="p">(</span><span class="n">filename_</span><span class="p">,</span> <span class="n">data_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a NumPy array to a binary file.</span>

<span class="sd">    This function saves a NumPy array to a file in .npy format. If the file cannot be created or written to, it handles common exceptions and prints an error message.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    filename_ : str</span>
<span class="sd">        The path to the file where the NumPy array will be saved.</span>
<span class="sd">    data_ : numpy.ndarray</span>
<span class="sd">        The NumPy array to be saved.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        The function does not return any value. It handles exceptions internally and prints error messages if any issues occur.</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; arr = np.array([1, 2, 3, 4, 5])</span>
<span class="sd">    &gt;&gt;&gt; save_np(&#39;array.npy&#39;, arr)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename_</span><span class="p">,</span> <span class="n">data_</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">EOFError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1"> - saving&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="load_np"><a class="viewcode-back" href="../../api/ssapy.io.load_np.html#ssapy.io.load_np">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">load_np</span><span class="p">(</span><span class="n">filename_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a NumPy array from a binary file.</span>

<span class="sd">    This function loads a NumPy array from a file in .npy format. If the file cannot be read, it handles common exceptions and prints an error message. If loading fails, it returns an empty list.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    filename_ : str</span>
<span class="sd">        The path to the file from which the NumPy array will be loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray or list</span>
<span class="sd">        The loaded NumPy array. If an error occurs during loading, returns an empty list.</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; arr = load_np(&#39;array.npy&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(arr)</span>
<span class="sd">    [1 2 3 4 5]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename_</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">EOFError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1"> - loading&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">data</span></div>


<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="c1">######################################################################</span>
<span class="c1"># HDF5 py files h5py</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="append_h5"><a class="viewcode-back" href="../../api/ssapy.io.append_h5.html#ssapy.io.append_h5">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">append_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">append_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append data to key in HDF5 file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The filename of the HDF5 file.</span>
<span class="sd">        pathname (str): The path to the key in the HDF5 file.</span>
<span class="sd">        append_data (any): The data to be appended.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pathname</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">path_data_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pathname</span><span class="p">))</span>
                <span class="n">append_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_data_old</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">append_data</span><span class="p">))</span>
                <span class="k">del</span> <span class="n">f</span><span class="p">[</span><span class="n">pathname</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">append_data</span><span class="p">),</span> <span class="n">maxshape</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2">Creating new dataset: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">save_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">append_data</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="overwrite_h5"><a class="viewcode-back" href="../../api/ssapy.io.overwrite_h5.html#ssapy.io.overwrite_h5">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">overwrite_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overwrite key in HDF5 file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The filename of the HDF5 file.</span>
<span class="sd">        pathname (str): The path to the key in the HDF5 file.</span>
<span class="sd">        new_data (any): The data to be overwritten.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">new_data</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">f</span><span class="p">[</span><span class="n">pathname</span><span class="p">]</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">new_data</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File: </span><span class="si">{</span><span class="n">filename</span><span class="si">}{</span><span class="n">pathname</span><span class="si">}</span><span class="s1">, Error: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">BlockingIOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="se">\n</span><span class="s2">Path: </span><span class="si">{</span><span class="n">pathname</span><span class="si">}</span><span class="se">\n</span><span class="s2">File: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>
            

<div class="viewcode-block" id="save_h5"><a class="viewcode-back" href="../../api/ssapy.io.save_h5.html#ssapy.io.save_h5">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">save_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save data to HDF5 file with recursive attempt in case of write errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The filename of the HDF5 file.</span>
<span class="sd">        pathname (str): The path to the data in the HDF5 file.</span>
<span class="sd">        data (any): The data to be saved.</span>
<span class="sd">        max_retries (int): Maximum number of recursive retries in case of write errors.</span>
<span class="sd">        retry_delay (tuple): A tuple representing the range of delay (in seconds) between retries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Did not save, key: </span><span class="si">{</span><span class="n">pathname</span><span class="si">}</span><span class="s2"> exists in file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="c1"># If the key already exists, no need to retry</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">BlockingIOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="se">\n</span><span class="s2">Path: </span><span class="si">{</span><span class="n">pathname</span><span class="si">}</span><span class="se">\n</span><span class="s2">File: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="read_h5"><a class="viewcode-back" href="../../api/ssapy.io.read_h5.html#ssapy.io.read_h5">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">read_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load data from HDF5 file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The filename of the HDF5 file.</span>
<span class="sd">        pathname (str): The path to the data in the HDF5 file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The data loaded from the HDF5 file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File not found. </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">BlockingIOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="se">\n</span><span class="s2">Path: </span><span class="si">{</span><span class="n">pathname</span><span class="si">}</span><span class="se">\n</span><span class="s2">File: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>


<div class="viewcode-block" id="read_h5_all"><a class="viewcode-back" href="../../api/ssapy.io.read_h5_all.html#ssapy.io.read_h5_all">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">read_h5_all</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read all datasets from an HDF5 file into a dictionary.</span>

<span class="sd">    This function recursively traverses an HDF5 file and extracts all datasets into a dictionary. The keys of the dictionary are the paths to the datasets, and the values are the dataset contents. </span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path : str</span>
<span class="sd">        The path to the HDF5 file from which datasets will be read.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary where keys are the paths to datasets within the HDF5 file, and values are the contents of these datasets.</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; data = read_h5_all(&#39;example.h5&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(data.keys())</span>
<span class="sd">    dict_keys([&#39;/group1/dataset1&#39;, &#39;/group2/dataset2&#39;])</span>
<span class="sd">    &gt;&gt;&gt; print(data[&#39;/group1/dataset1&#39;])</span>
<span class="sd">    [1, 2, 3, 4, 5]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="c1"># Recursive function to traverse the HDF5 file and populate the dictionary</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">traverse</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">new_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="n">key</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                    <span class="n">traverse</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">new_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data_dict</span><span class="p">[</span><span class="n">new_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[()]</span>

        <span class="n">traverse</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data_dict</span></div>


<div class="viewcode-block" id="combine_h5"><a class="viewcode-back" href="../../api/ssapy.io.combine_h5.html#ssapy.io.combine_h5">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">combine_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine multiple HDF5 files into a single HDF5 file.</span>

<span class="sd">    This function reads datasets from a list of HDF5 files and writes them to a specified output HDF5 file. If `overwrite` is `True`, it will remove any existing file at the specified `filename` before combining the files. The `verbose` parameter, if set to `True`, will display progress bars during the process.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The path to the output HDF5 file where the combined datasets will be stored.</span>
<span class="sd">    </span>
<span class="sd">    files : list of str</span>
<span class="sd">        A list of paths to the HDF5 files to be combined.</span>

<span class="sd">    verbose : bool, optional</span>
<span class="sd">        If `True`, progress bars will be displayed for the file and key processing. Default is `False`.</span>

<span class="sd">    overwrite : bool, optional</span>
<span class="sd">        If `True`, any existing file at `filename` will be removed before writing the new combined file. Default is `False`.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        The function performs file operations and does not return any value.</span>

<span class="sd">    Examples:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; combine_h5(&#39;combined.h5&#39;, [&#39;file1.h5&#39;, &#39;file2.h5&#39;], verbose=True, overwrite=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
        <span class="n">iterable</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iterable</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="n">rmfile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">iterable2</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">h5_keys</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iterable2</span> <span class="o">=</span> <span class="n">files</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">iterable2</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">h5_key_exists</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">save_h5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">read_h5</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">read_h5</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">, key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">, file: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Completed HDF5 merge.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="h5_keys"><a class="viewcode-back" href="../../api/ssapy.io.h5_keys.html#ssapy.io.h5_keys">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">h5_keys</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List all groups in HDF5 file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): The file_path of the HDF5 file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of group keys in the HDF5 file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="c1"># Recursive function to traverse the HDF5 file and collect keys</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">traverse</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">new_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="n">key</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                    <span class="n">traverse</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">new_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keys_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
        <span class="n">traverse</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">keys_list</span></div>


<div class="viewcode-block" id="h5_root_keys"><a class="viewcode-back" href="../../api/ssapy.io.h5_root_keys.html#ssapy.io.h5_root_keys">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">h5_root_keys</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the keys in the root group of an HDF5 file.</span>

<span class="sd">    This function opens an HDF5 file and returns a list of keys (dataset or group names) located in the root group of the file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path : str</span>
<span class="sd">        The path to the HDF5 file from which the root group keys are to be retrieved.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    list of str</span>
<span class="sd">        A list of keys in the root group of the HDF5 file. These keys represent the names of datasets or groups present at the root level of the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">keys_in_root</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># print(&quot;Keys in the root group:&quot;, keys_in_root)</span>
        <span class="k">return</span> <span class="n">keys_in_root</span></div>


<div class="viewcode-block" id="h5_key_exists"><a class="viewcode-back" href="../../api/ssapy.io.h5_key_exists.html#ssapy.io.h5_key_exists">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">h5_key_exists</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if a key exists in an HDF5 file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The filename of the HDF5 file.</span>
<span class="sd">        key (str): The key to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the key exists, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">f</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<span class="c1">######################################################################</span>
<span class="c1"># CSV</span>
<span class="c1">######################################################################</span>


<div class="viewcode-block" id="makedf"><a class="viewcode-back" href="../../api/ssapy.io.makedf.html#ssapy.io.makedf">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">makedf</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an input into a pandas DataFrame.</span>

<span class="sd">    This function takes an input which can be a list or a dictionary and converts it into a pandas DataFrame. If the input is already a DataFrame, it returns it unchanged.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    df : list, dict, or pd.DataFrame</span>
<span class="sd">        The input data to be converted into a DataFrame. This can be a list or dictionary to be transformed into a DataFrame, or an existing DataFrame which will be returned as is.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        A DataFrame created from the input data if the input is a list or dictionary. If the input is already a DataFrame, the original DataFrame is returned unchanged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="read_csv_header"><a class="viewcode-back" href="../../api/ssapy.io.read_csv_header.html#ssapy.io.read_csv_header">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">read_csv_header</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the header of a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str): The filename of the CSV file.</span>
<span class="sd">        sep (str) optional: The delimiter used in the CSV file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of the header fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">guess_csv_delimiter</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>  <span class="c1"># Guess the delimiter</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">fieldnames</span>
    <span class="k">return</span> <span class="n">fieldnames</span></div>


<div class="viewcode-block" id="read_csv"><a class="viewcode-back" href="../../api/ssapy.io.read_csv.html#ssapy.io.read_csv">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_np</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a CSV file with options.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : str</span>
<span class="sd">        The path to the CSV file.</span>
<span class="sd">    sep : str, optional</span>
<span class="sd">        The delimiter used in the CSV file. If None, delimiter will be guessed.</span>
<span class="sd">    dtypes : dict, optional</span>
<span class="sd">        Dictionary specifying data types for columns.</span>
<span class="sd">    col : bool or list of str, optional</span>
<span class="sd">        Specify columns to read. If False, read all columns.</span>
<span class="sd">    to_np : bool, optional</span>
<span class="sd">        Convert the loaded data to a NumPy array.</span>
<span class="sd">    drop_nan : bool, optional</span>
<span class="sd">        Drop rows with missing values (NaNs) from the loaded DataFrame.</span>
<span class="sd">    skiprows : list of int, optional</span>
<span class="sd">        Rows to skip while reading the CSV file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame or NumPy array</span>
<span class="sd">        The loaded data in either a DataFrame or a NumPy array format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">guess_csv_delimiter</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>  <span class="c1"># Guess the delimiter</span>

    <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">on_bad_lines</span><span class="o">=</span><span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">on_bad_lines</span><span class="o">=</span><span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">drop_nan</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">to_np</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="append_dict_to_csv"><a class="viewcode-back" href="../../api/ssapy.io.append_dict_to_csv.html#ssapy.io.append_dict_to_csv">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">append_dict_to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append data from a dictionary to a CSV file.</span>

<span class="sd">    This function appends rows of data to a CSV file, where each key-value pair in the dictionary represents a column. If the CSV file does not already exist, it creates the file and writes the header row using the dictionary keys.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name : str</span>
<span class="sd">        Path to the CSV file where data will be appended.</span>
<span class="sd">    data_dict : dict</span>
<span class="sd">        Dictionary where keys are column headers and values are lists of data to be written to the CSV file. All lists should be of the same length.</span>
<span class="sd">    delimiter : str, optional</span>
<span class="sd">        The delimiter used in the CSV file (default is tab `\t`).</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - The function assumes that all lists in the dictionary `data_dict` have the same length.</span>
<span class="sd">    - If the CSV file already exists, only the data rows are appended. If it doesn&#39;t exist, a new file is created with the header row based on the dictionary keys.</span>
<span class="sd">    - The `delimiter` parameter allows specifying the delimiter used in the CSV file. Common values are `,` for commas and `\t` for tabs.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; data_dict = {</span>
<span class="sd">    &gt;&gt;&gt;     &#39;Name&#39;: [&#39;Alice&#39;, &#39;Bob&#39;, &#39;Charlie&#39;],</span>
<span class="sd">    &gt;&gt;&gt;     &#39;Age&#39;: [25, 30, 35],</span>
<span class="sd">    &gt;&gt;&gt;     &#39;City&#39;: [&#39;New York&#39;, &#39;Los Angeles&#39;, &#39;Chicago&#39;]</span>
<span class="sd">    &gt;&gt;&gt; }</span>
<span class="sd">    &gt;&gt;&gt; append_dict_to_csv(&#39;people.csv&#39;, data_dict, delimiter=&#39;,&#39;)</span>
<span class="sd">    This will append data to &#39;people.csv&#39;, creating it if it does not exist, with columns &#39;Name&#39;, &#39;Age&#39;, &#39;City&#39;.</span>

<span class="sd">    Dependencies:</span>
<span class="sd">    --------------</span>
<span class="sd">    - `os.path.exists`: Used to check if the file already exists.</span>
<span class="sd">    - `csv`: Standard library module used for reading and writing CSV files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract keys and values from the dictionary</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Determine the length of the arrays</span>
    <span class="n">array_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Determine if file exists</span>
    <span class="n">file_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

    <span class="c1"># Open the CSV file in append mode</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>

        <span class="c1"># Write header if file doesn&#39;t exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_exists</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

        <span class="c1"># Write each element from arrays as a new row</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array_length</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">))]</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div>


<div class="viewcode-block" id="guess_csv_delimiter"><a class="viewcode-back" href="../../api/ssapy.io.guess_csv_delimiter.html#ssapy.io.guess_csv_delimiter">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">guess_csv_delimiter</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Guess the delimiter used in a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str): The path to the CSV file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Guessed delimiter (one of &#39;,&#39;, &#39;\t&#39;, &#39;;&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>  <span class="c1"># Read a sample of the file&#39;s contents</span>
        <span class="n">sniffer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">Sniffer</span><span class="p">()</span>
        <span class="n">dialect</span> <span class="o">=</span> <span class="n">sniffer</span><span class="o">.</span><span class="n">sniff</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dialect</span><span class="o">.</span><span class="n">delimiter</span></div>


<div class="viewcode-block" id="save_csv"><a class="viewcode-back" href="../../api/ssapy.io.save_csv.html#ssapy.io.save_csv">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">save_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a Pandas DataFrame to a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str): The path to the CSV file.</span>
<span class="sd">        df (DataFrame): The Pandas DataFrame to save.</span>
<span class="sd">        sep (str): The delimiter used in the CSV file.</span>
<span class="sd">        dtypes (dict): A dictionary specifying data types for columns.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">makedf</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtypes</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>

    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1"> successfully.&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="append_csv"><a class="viewcode-back" href="../../api/ssapy.io.append_csv.html#ssapy.io.append_csv">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">append_csv</span><span class="p">(</span><span class="n">file_names</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;combined_data.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Appends multiple CSV files into a single CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_names (list): A list of CSV file names.</span>
<span class="sd">        save_path (str): The path to the output CSV file. If not specified, the output will be saved to the current working directory.</span>
<span class="sd">        sep (str): The delimiter used in the CSV files.</span>
<span class="sd">        dtypes (dict): A dictionary specifying data types for columns.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">error_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_names</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="n">guess_csv_delimiter</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  <span class="c1"># Guess the delimiter</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">get_memory_usage</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Appended </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_names</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ParserError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtypes</span><span class="p">:</span>
        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">combined_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">combined_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;combined_data.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The final dataframe has </span><span class="si">{</span><span class="n">combined_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> rows and </span><span class="si">{</span><span class="n">combined_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> columns.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">error_files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The following files ERRORED and were not included: </span><span class="si">{</span><span class="n">error_files</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="append_csv_on_disk"><a class="viewcode-back" href="../../api/ssapy.io.append_csv_on_disk.html#ssapy.io.append_csv_on_disk">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">append_csv_on_disk</span><span class="p">(</span><span class="n">csv_files</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append multiple CSV files into a single CSV file.</span>

<span class="sd">    This function merges multiple CSV files into one output CSV file. The output file will contain the header row from the first CSV file and data rows from all input CSV files. </span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    csv_files : list of str</span>
<span class="sd">        List of file paths to the CSV files to be merged. All CSV files should have the same delimiter and structure.</span>
<span class="sd">    output_file : str</span>
<span class="sd">        Path to the output CSV file where the merged data will be written.</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    - The function assumes all input CSV files have the same delimiter. It determines the delimiter from the first CSV file using the `guess_csv_delimiter` function.</span>
<span class="sd">    - Only the header row from the first CSV file is included in the output file. Headers from subsequent files are ignored.</span>
<span class="sd">    - This function overwrites the output file if it already exists.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; csv_files = [&#39;file1.csv&#39;, &#39;file2.csv&#39;, &#39;file3.csv&#39;]</span>
<span class="sd">    &gt;&gt;&gt; output_file = &#39;merged_output.csv&#39;</span>
<span class="sd">    &gt;&gt;&gt; append_csv_on_disk(csv_files, output_file)</span>
<span class="sd">    Completed appending of: merged_output.csv.</span>

<span class="sd">    Dependencies:</span>
<span class="sd">    --------------</span>
<span class="sd">    - `guess_csv_delimiter` function: A utility function used to guess the delimiter of the CSV files.</span>
<span class="sd">    - `csv` module: Standard library module used for reading and writing CSV files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Assumes each file has the same delimiters</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="n">guess_csv_delimiter</span><span class="p">(</span><span class="n">csv_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Open the output file for writing</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="c1"># Initialize the CSV writer</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>

        <span class="c1"># Write the header row from the first CSV file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">first_file</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">first_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
            <span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

            <span class="c1"># Write the data rows from the first CSV file</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># Write the data rows from the remaining CSV files</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">csv_files</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>  <span class="c1"># Skip the header row</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed appending of: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_csv_header"><a class="viewcode-back" href="../../api/ssapy.io.save_csv_header.html#ssapy.io.save_csv_header">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">save_csv_header</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves a header row to a CSV file with a specified delimiter.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    filename (str): The name of the file where the header will be saved.</span>
<span class="sd">    header (list): A list of strings representing the column names.</span>
<span class="sd">    delimiter (str, optional): The delimiter to use between columns in the CSV file. </span>
<span class="sd">                               Default is tab (&#39;\t&#39;).</span>

<span class="sd">    Example:</span>
<span class="sd">    save_csv_header(&#39;output.csv&#39;, [&#39;Name&#39;, &#39;Age&#39;, &#39;City&#39;], delimiter=&#39;,&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">header</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_csv_array_to_line"><a class="viewcode-back" href="../../api/ssapy.io.save_csv_array_to_line.html#ssapy.io.save_csv_array_to_line">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">save_csv_array_to_line</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Appends a single row of data to a CSV file with a specified delimiter.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    filename (str): The name of the file to which the row will be appended.</span>
<span class="sd">    array (list): A list of values representing a single row of data to be appended to the CSV file.</span>
<span class="sd">    delimiter (str, optional): The delimiter to use between columns in the CSV file. </span>
<span class="sd">                               Default is tab (&#39;\t&#39;).</span>

<span class="sd">    Example:</span>
<span class="sd">    save_csv_array_to_line(&#39;output.csv&#39;, [&#39;Alice&#39;, 30, &#39;New York&#39;], delimiter=&#39;,&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">array</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_csv_line"><a class="viewcode-back" href="../../api/ssapy.io.save_csv_line.html#ssapy.io.save_csv_line">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">save_csv_line</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a Pandas DataFrame to a CSV file, appending the DataFrame to the file if it exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name (str): The path to the CSV file.</span>
<span class="sd">        df (DataFrame): The Pandas DataFrame to save.</span>
<span class="sd">        sep (str): The delimiter used in the CSV file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">makedf</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtypes</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">return</span></div>


<span class="n">_column_data</span> <span class="o">=</span> <span class="kc">None</span>
<div class="viewcode-block" id="exists_in_csv"><a class="viewcode-back" href="../../api/ssapy.io.exists_in_csv.html#ssapy.io.exists_in_csv">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">exists_in_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if a number exists in a specific column of a CSV file.</span>

<span class="sd">    This function reads a specified column from a CSV file and checks if a given number is present in that column.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    csv_file : str</span>
<span class="sd">        Path to the CSV file.</span>
<span class="sd">    column : str or int</span>
<span class="sd">        The column to search in.</span>
<span class="sd">    number : int or float</span>
<span class="sd">        The number to check for existence in the column.</span>
<span class="sd">    sep : str, default=&#39;\t&#39;</span>
<span class="sd">        Delimiter used in the CSV file.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the number exists in the column, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">_column_data</span>
        <span class="k">if</span> <span class="n">_column_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_column_data</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">to_np</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">_column_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="exists_in_csv_old"><a class="viewcode-back" href="../../api/ssapy.io.exists_in_csv_old.html#ssapy.io.exists_in_csv_old">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">exists_in_csv_old</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a specific value exists in a given column of a CSV file.</span>

<span class="sd">    This function reads a CSV file and checks whether the specified `number` </span>
<span class="sd">    exists in the specified `column`. If the file cannot be opened or read, </span>
<span class="sd">    the function returns `False`.</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_file (str): The path to the CSV file.</span>
<span class="sd">        column (str): The name of the column to search in.</span>
<span class="sd">        number (int or str): The value to search for in the specified column.</span>
<span class="sd">        sep (str, optional): The delimiter used in the CSV file. Defaults to &#39;\t&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: </span>
<span class="sd">            - `True` if the value exists in the specified column.</span>
<span class="sd">            - `False` if the value does not exist or if the file cannot be opened.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="pd_flatten"><a class="viewcode-back" href="../../api/ssapy.io.pd_flatten.html#ssapy.io.pd_flatten">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">pd_flatten</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flatten and process a list of data values.</span>

<span class="sd">    This function takes a list of data values, attempts to split each value </span>
<span class="sd">    based on commas (excluding the first and last characters), and flattens </span>
<span class="sd">    the resulting list. If splitting fails (e.g., due to a `TypeError`), the </span>
<span class="sd">    original value is added to the result. Finally, all values are converted </span>
<span class="sd">    to floats and divided by the specified `factor`.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (list): A list of data values to be processed. Each value can be </span>
<span class="sd">                     a string or a type that supports slicing and splitting.</span>
<span class="sd">        factor (float, optional): A divisor applied to each processed value. </span>
<span class="sd">                                  Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of processed float values, flattened and divided by `factor`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">factor</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">]</span></div>

<span class="c1">#</span>
<span class="c1"># TURN AN ARRAY SAVED AS A STRING BACK INTO AN ARRAY</span>


<div class="viewcode-block" id="str_to_array"><a class="viewcode-back" href="../../api/ssapy.io.str_to_array.html#ssapy.io.str_to_array">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">str_to_array</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string representation of an array back into a NumPy array.</span>

<span class="sd">    This function takes a string formatted as an array (e.g., &quot;[1.0, 2.0, 3.0]&quot;),</span>
<span class="sd">    removes the square brackets, splits the elements by commas, and converts </span>
<span class="sd">    them into a NumPy array of floats.</span>

<span class="sd">    Args:</span>
<span class="sd">        s (str): A string representation of an array, with elements separated </span>
<span class="sd">                 by commas and enclosed in square brackets.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: A NumPy array containing the float values extracted </span>
<span class="sd">                       from the input string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Remove square brackets</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="pdstr_to_arrays"><a class="viewcode-back" href="../../api/ssapy.io.pdstr_to_arrays.html#ssapy.io.pdstr_to_arrays">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">pdstr_to_arrays</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a pandas Series or DataFrame with string representations of arrays </span>
<span class="sd">    into a NumPy array of actual arrays.</span>

<span class="sd">    This function applies the `str_to_array` function to each element of the </span>
<span class="sd">    input pandas object (Series or DataFrame), converting string representations </span>
<span class="sd">    of arrays into NumPy arrays. The result is returned as a NumPy array.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pandas.Series or pandas.DataFrame): A pandas object containing </span>
<span class="sd">                                                string representations of arrays.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: A NumPy array where each element is a NumPy array </span>
<span class="sd">                       derived from the corresponding string in the input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">str_to_array</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_all_files_recursive"><a class="viewcode-back" href="../../api/ssapy.io.get_all_files_recursive.html#ssapy.io.get_all_files_recursive">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_all_files_recursive</span><span class="p">(</span><span class="n">path_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively retrieve all file paths from a directory and its subdirectories.</span>

<span class="sd">    This function walks through the directory tree starting from the specified </span>
<span class="sd">    path and collects the full paths of all files found. If no path is provided, </span>
<span class="sd">    it defaults to the current working directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_name (str, optional): The root directory to start the search. </span>
<span class="sd">                                   Defaults to the current working directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of full file paths for all files found in the directory </span>
<span class="sd">              tree starting at `path_name`.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="n">listOfFiles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span><span class="p">)</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path_name</span><span class="p">):</span>
        <span class="n">listOfFiles</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">listOfFiles</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Lawrence Livermore National Security, LLC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>